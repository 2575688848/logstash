input{
    kafka{
        bootstrap_servers => "10.20.0.19:9092,10.20.0.20:9092,10.20.0.22:9092"
        group_id => "nginx_wannx_www"
        topics => ["higo_wap_log","higo_other_log"]
        consumer_threads => 32
    }
}

filter {
    grok {
        match => {
            "message" => "\[%{DATA:remote_addr}\] \[%{DATA:remote_user}\] \[%{HTTPDATE:time_local}\] \[%{DATA:request}\] \[%{DATA:status}\] \[%{NUMBER:body_bytes_sent}\] \[%{DATA:http_referer}\] \[%{DATA:http_user_agent}\] \[%{DATA:http_x_forwarded_for}\] \[%{DATA:http_cookie}\] \[%{NUMBER:request_time}\] \[%{DATA:upstream_addr}\] \[%{NUMBER:upstream_response_time}\] \[%{DATA:empty}\] \[%{DATA:host}\] \[%{DATA:sent_http_set_cookie}\]"
        }
    }

    if [upstream_response_time] == "-" {
        mutate { remove_field => "upstream_response_time" }
    }

    if [request_time] == "-" {
        mutate { remove_field => "request_time" }
    }

    if [body_bytes_sent] == "-" {
        mutate { remove_field => "body_bytes_sent" }
    }

}


output {
    elasticsearch {
                index => "nginx_wannx_www_%{+YYYY.MM.dd}"
                hosts => ["http://localhost:9200"]
    }
}
